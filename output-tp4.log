nohup: ignoring input
WARNING:root:libtpu.so and TPU device found. Setting PJRT_DEVICE=TPU.
INFO 03-09 21:22:24 [__init__.py:256] Automatically detected platform tpu.
INFO 03-09 21:22:25 [api_server.py:912] vLLM API server version 0.7.4.dev339+ga21076ed.d20250309
INFO 03-09 21:22:25 [api_server.py:913] args: Namespace(subparser='serve', model_tag='meta-llama/Meta-Llama-3.1-8B', config='', host=None, port=8000, uvicorn_log_level='info', allow_credentials=False, allowed_origins=['*'], allowed_methods=['*'], allowed_headers=['*'], api_key=None, lora_modules=None, prompt_adapters=None, chat_template=None, chat_template_content_format='auto', response_role='assistant', ssl_keyfile=None, ssl_certfile=None, ssl_ca_certs=None, enable_ssl_refresh=False, ssl_cert_reqs=0, root_path=None, middleware=[], return_tokens_as_token_ids=False, disable_frontend_multiprocessing=False, enable_request_id_headers=False, enable_auto_tool_choice=False, tool_call_parser=None, tool_parser_plugin='', model='meta-llama/Meta-Llama-3.1-8B', task='auto', tokenizer=None, hf_config_path=None, skip_tokenizer_init=False, revision=None, code_revision=None, tokenizer_revision=None, tokenizer_mode='auto', trust_remote_code=False, allowed_local_media_path=None, download_dir='/dev/shm', load_format='auto', config_format=<ConfigFormat.AUTO: 'auto'>, dtype='auto', kv_cache_dtype='auto', max_model_len=4096, guided_decoding_backend='xgrammar', logits_processor_pattern=None, model_impl='auto', distributed_executor_backend=None, pipeline_parallel_size=1, tensor_parallel_size=4, enable_expert_parallel=False, max_parallel_loading_workers=None, ray_workers_use_nsight=False, block_size=None, enable_prefix_caching=None, disable_sliding_window=False, use_v2_block_manager=True, num_lookahead_slots=0, seed=None, swap_space=16.0, cpu_offload_gb=0, gpu_memory_utilization=0.9, num_gpu_blocks_override=None, max_num_batched_tokens=8192, max_num_partial_prefills=1, max_long_partial_prefills=1, long_prefill_token_threshold=0, max_num_seqs=128, max_logprobs=20, disable_log_stats=False, quantization=None, rope_scaling=None, rope_theta=None, hf_overrides=None, enforce_eager=False, max_seq_len_to_capture=8192, disable_custom_all_reduce=False, tokenizer_pool_size=0, tokenizer_pool_type='ray', tokenizer_pool_extra_config=None, limit_mm_per_prompt=None, mm_processor_kwargs=None, disable_mm_preprocessor_cache=False, enable_lora=False, enable_lora_bias=False, max_loras=1, max_lora_rank=16, lora_extra_vocab_size=256, lora_dtype='auto', long_lora_scaling_factors=None, max_cpu_loras=None, fully_sharded_loras=False, enable_prompt_adapter=False, max_prompt_adapters=1, max_prompt_adapter_token=0, device='auto', num_scheduler_steps=1, use_tqdm_on_load=True, multi_step_stream_outputs=True, scheduler_delay_factor=0.0, enable_chunked_prefill=None, speculative_model=None, speculative_model_quantization=None, num_speculative_tokens=None, speculative_disable_mqa_scorer=False, speculative_draft_tensor_parallel_size=None, speculative_max_model_len=None, speculative_disable_by_batch_size=None, ngram_prompt_lookup_max=None, ngram_prompt_lookup_min=None, spec_decoding_acceptance_method='rejection_sampler', typical_acceptance_sampler_posterior_threshold=None, typical_acceptance_sampler_posterior_alpha=None, disable_logprobs_during_spec_decoding=None, model_loader_extra_config=None, ignore_patterns=[], preemption_mode=None, served_model_name=None, qlora_adapter_name_or_path=None, show_hidden_metrics_for_version=None, otlp_traces_endpoint=None, collect_detailed_traces=None, disable_async_output_proc=False, scheduling_policy='fcfs', scheduler_cls='vllm.core.scheduler.Scheduler', override_neuron_config=None, override_pooler_config=None, compilation_config=None, kv_transfer_config=None, worker_cls='auto', worker_extension_cls='', generation_config='auto', override_generation_config=None, enable_sleep_mode=False, calculate_kv_scales=False, additional_config=None, enable_reasoning=False, reasoning_parser=None, disable_log_requests=True, max_log_len=None, disable_fastapi_docs=False, enable_prompt_tokens_details=False, dispatch_function=<function ServeSubcommand.cmd at 0x7867cb37c820>)
INFO 03-09 21:22:31 [config.py:576] This model supports multiple tasks: {'generate', 'reward', 'score', 'embed', 'classify'}. Defaulting to 'generate'.
INFO 03-09 21:22:31 [config.py:1666] Chunked prefill is enabled with max_num_batched_tokens=8192.
INFO 03-09 21:22:31 [tpu.py:76] [TPU] Forcing DYNAMO_ONCE compilation level
WARNING 03-09 21:22:31 [tpu.py:108] [V1][TPU] Disable prefix caching
INFO 03-09 21:22:35 [__init__.py:256] Automatically detected platform tpu.
INFO 03-09 21:22:35 [core.py:51] Initializing a V1 LLM engine (v0.7.4.dev339+ga21076ed.d20250309) with config: model='meta-llama/Meta-Llama-3.1-8B', speculative_config=None, tokenizer='meta-llama/Meta-Llama-3.1-8B', skip_tokenizer_init=False, tokenizer_mode=auto, revision=None, override_neuron_config=None, tokenizer_revision=None, trust_remote_code=False, dtype=torch.bfloat16, max_seq_len=4096, download_dir='/dev/shm', load_format=auto, tensor_parallel_size=4, pipeline_parallel_size=1, disable_custom_all_reduce=False, quantization=None, enforce_eager=False, kv_cache_dtype=auto,  device_config=None, decoding_config=DecodingConfig(guided_decoding_backend='xgrammar', reasoning_backend=None), observability_config=ObservabilityConfig(show_hidden_metrics=False, otlp_traces_endpoint=None, collect_model_forward_time=False, collect_model_execute_time=False), seed=None, served_model_name=meta-llama/Meta-Llama-3.1-8B, num_scheduler_steps=1, multi_step_stream_outputs=True, enable_prefix_caching=False, chunked_prefill_enabled=True, use_async_output_proc=False, disable_mm_preprocessor_cache=False, mm_processor_kwargs=None, pooler_config=None, compilation_config={"level":2,"backend":"openxla","custom_ops":["none"],"splitting_ops":["vllm.unified_attention","vllm.unified_attention_with_output"],"use_inductor":true,"compile_sizes":[],"use_cudagraph":true,"cudagraph_num_of_warmups":1,"cudagraph_capture_sizes":[512,504,496,488,480,472,464,456,448,440,432,424,416,408,400,392,384,376,368,360,352,344,336,328,320,312,304,296,288,280,272,264,256,248,240,232,224,216,208,200,192,184,176,168,160,152,144,136,128,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,4,2,1],"max_capture_size":512}
2025-03-09 21:22:37,329	INFO worker.py:1832 -- Started a local Ray instance. View the dashboard at [1m[32m127.0.0.1:8265 [39m[22m
INFO 03-09 21:22:38 [ray_distributed_executor.py:176] use_ray_spmd_worker: True
[36m(pid=1422473)[0m INFO 03-09 21:22:41 [__init__.py:256] Automatically detected platform tpu.
INFO 03-09 21:22:42 [ray_distributed_executor.py:350] non_carry_over_env_vars from config: set()
INFO 03-09 21:22:42 [ray_distributed_executor.py:352] Copying the following environment variables to workers: ['LD_LIBRARY_PATH', 'VLLM_USE_RAY_SPMD_WORKER', 'VLLM_USE_RAY_COMPILED_DAG', 'VLLM_USE_RAY_COMPILED_DAG_NCCL_CHANNEL', 'VLLM_WORKER_MULTIPROC_METHOD', 'VLLM_USE_V1']
INFO 03-09 21:22:42 [ray_distributed_executor.py:355] If certain env vars should NOT be copied to workers, add them to /home/hosseins/.config/vllm/ray_non_carry_over_env_vars.json file
[36m(RayWorkerWrapper pid=1422473)[0m Loading safetensors checkpoint shards:   0% Completed | 0/4 [00:00<?, ?it/s]
[36m(RayWorkerWrapper pid=1422473)[0m Loading safetensors checkpoint shards:  25% Completed | 1/4 [00:00<00:00,  6.91it/s]
[36m(RayWorkerWrapper pid=1422473)[0m Loading safetensors checkpoint shards:  50% Completed | 2/4 [00:00<00:00,  2.61it/s]
[36m(RayWorkerWrapper pid=1422473)[0m Loading safetensors checkpoint shards:  75% Completed | 3/4 [00:01<00:00,  2.25it/s]
[36m(RayWorkerWrapper pid=1422473)[0m Loading safetensors checkpoint shards: 100% Completed | 4/4 [00:01<00:00,  2.23it/s]
[36m(RayWorkerWrapper pid=1422473)[0m Loading safetensors checkpoint shards: 100% Completed | 4/4 [00:01<00:00,  2.40it/s]
[36m(RayWorkerWrapper pid=1422473)[0m 
[36m(RayWorkerWrapper pid=1422473)[0m WARNING 03-09 21:22:42 [utils.py:577] Overwriting environment variable TPU_VISIBLE_CHIPS from '0' to '0,1,2,3'
[36m(RayWorkerWrapper pid=1422473)[0m WARNING 03-09 21:22:42 [utils.py:577] Overwriting environment variable LD_LIBRARY_PATH from '/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:' to '/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:'
[36m(RayWorkerWrapper pid=1422473)[0m INFO 03-09 21:22:51 [shm_broadcast.py:258] vLLM message queue communication handle: Handle(local_reader_ranks=[1, 2, 3], buffer_handle=(3, 4194304, 6, 'psm_02e2d8d8'), local_subscribe_addr='ipc:///dev/shm/ray/e3cfc8af-7efe-4160-9a35-e7f3da5167d7', remote_subscribe_addr=None, remote_addr_ipv6=False)
[36m(RayWorkerWrapper pid=1422473)[0m INFO 03-09 21:22:51 [parallel_state.py:948] rank 0 in world size 4 is assigned as DP rank 0, PP rank 0, TP rank 0
[36m(RayWorkerWrapper pid=1422473)[0m WARNING 03-09 21:22:51 [tpu.py:116] Pin memory is not supported on TPU.
[36m(pid=1422485)[0m INFO 03-09 21:22:41 [__init__.py:256] Automatically detected platform tpu.[32m [repeated 3x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
[36m(RayWorkerWrapper pid=1422485)[0m WARNING 03-09 21:22:42 [utils.py:577] Overwriting environment variable TPU_VISIBLE_CHIPS from '3' to '0,1,2,3'[32m [repeated 3x across cluster][0m
[36m(RayWorkerWrapper pid=1422485)[0m WARNING 03-09 21:22:42 [utils.py:577] Overwriting environment variable LD_LIBRARY_PATH from '/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:' to '/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:/home/hosseins/miniconda3/envs/vllm-v1/lib/python3.10/site-packages/cv2/../../lib64:'[32m [repeated 3x across cluster][0m
[36m(RayWorkerWrapper pid=1422473)[0m INFO 03-09 21:22:51 [tpu.py:39] Cannot use None backend on TPU.
[36m(RayWorkerWrapper pid=1422473)[0m INFO 03-09 21:22:51 [tpu.py:42] Using Pallas V1 backend.
[36m(RayWorkerWrapper pid=1422473)[0m WARNING 03-09 21:22:51 [topk_topp_sampler.py:46] FlashInfer is not available. Falling back to the PyTorch-native implementation of top-p & top-k sampling. For the best performance, please install FlashInfer.
[36m(RayWorkerWrapper pid=1422472)[0m INFO 03-09 21:22:51 [weight_utils.py:257] Using model weights format ['*.safetensors']
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m hosseins: _xla_weights_iterator()
[36m(RayWorkerWrapper pid=1422472)[0m INFO 03-09 21:22:53 [loader.py:430] Loading weights took 1.86 seconds
INFO 03-09 21:23:46 [kv_cache_utils.py:537] GPU KV cache size: 779,152 tokens
INFO 03-09 21:23:46 [kv_cache_utils.py:540] Maximum concurrency for 4,096 tokens per request: 190.22x
INFO 03-09 21:23:46 [kv_cache_utils.py:537] GPU KV cache size: 779,152 tokens
INFO 03-09 21:23:46 [kv_cache_utils.py:540] Maximum concurrency for 4,096 tokens per request: 190.22x
INFO 03-09 21:23:46 [kv_cache_utils.py:537] GPU KV cache size: 779,152 tokens
INFO 03-09 21:23:46 [kv_cache_utils.py:540] Maximum concurrency for 4,096 tokens per request: 190.22x
INFO 03-09 21:23:46 [kv_cache_utils.py:537] GPU KV cache size: 779,152 tokens
INFO 03-09 21:23:46 [kv_cache_utils.py:540] Maximum concurrency for 4,096 tokens per request: 190.22x
